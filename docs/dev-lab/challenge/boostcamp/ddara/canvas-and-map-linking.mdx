---
slug: canvas-and-map-linking
title: '캔버스와 네이버 지도 API 연동하기'
tags: ['Frontend', 'BoostCamp']
sidebar_position: 2
sidebar_label: '002 캔버스와 네이버 지도 API 연동하기'
keywords: ['Frontend', 'Canvas', 'Graphic', 'JavaScript', 'Naver Boostcamp', '네이버 부스트캠프', '지도', 'Canvas']
last_update:
  date: 2024-11-20
  author: zen
---

## 🎯 이 문서를 읽고 난 후의 상태

- 프로젝트와 문제에 대한 컨텍스트를 이해했다.
- 지도와 캔버스를 연동하기 위해 어떤 설계 과정을 거쳤는지 이해했다.
- 네이버 지도와 캔버스를 연동하는 과정 속에서 겪은 어려움과 해결을 위한 시도를 알았다.
- 최종적으로 어떻게 네이버 지도와 캔버스를 연동했는지를 이해했다.

## 🤔 배경

현재 네이버 부스트캠프 9기에 참여해서 배우고 있다.<br/>

어느덧 마지막인 그룹 프로젝트를 하게 되었는데, "위치 기반 서비스"를 주제로 선정해서 진행하게 되었다.<br/>

"위치 기반 서비스"라는 큰 카테고리 내에서, 세부 주제를 정해서 진행해야만 했었다. <br/>

사업성이나, 아이디어의 독창성보다는 진짜 "우리가 쓸 법한, 우리 주변에 있는 문제를 해결해보자." 라는 취지에서 시작한 주제이다.<br/>

주제는 "중장년층을 위한 접근성을 바탕으로 한 위치 기반 서비스"로, 핵심은 지도 위에 캔버스를 띄우고, 거기에 자녀가 경로를 표시해서 부모님에게 전달하는 것이다.<br/>

[네이버 부스트캠프 9기 그룹 프로젝트 - DDara](https://github.com/boostcampwm-2024/web28-DDara)

이해를 돕기 위해서 먼저, 우리 프로젝트에 대한 깃허브 링크를 남긴다. <br/>

또한 프로젝트에 대한 전체 맥락은 이전 글을 참고하면 좋을 것 같다. <br/>

[네이버 부스트캠프 9기 그룹 프로젝트에 대한 전체 회고](/dev-lab/challenge/boostcamp/ddara/review-group-project-6-weeks)

## 🤔 어떻게 시작할 것인가?

내가 팀에서 맡게 된 일은 지도와 캔버스 사이의 연동이었다.<br/>

네이버 지도와 캔버스 모두 처음이었기에, 어떻게 연동을 시킬 지에 대한 고민이 많았다.<br/>

그래서 제일 먼저 한 일은 자료조사였다.<br/>

일단, 이 기술들이 무엇인지 알고, 어떻게 돌아가는 지에 대해서 알아야 설계를 할 수 있었기 때문이다.<br/>

import canvas_and_map_search from './img/canvas_and_map_search.webp'

<figure>
  <img style={{width:'30%'}} src={canvas_and_map_search} alt='참고 자료'/>
  <figcaption> 자료 조사 내용 </figcaption>
</figure>

찾은 자료의 일부분인데, 한번 정리하고 남은 자료들이다.<br/>

구글링 하면 나오는 온갖 사용 자료와, 네이버 지도 팀의 QnA, 타입 관련해서는 타입 깃허브 등 많은 자료를 찾았던 것 같다.<br/>

관련해서 혹시라도 도움이 될까 싶어 몇 가지 참고자료를 남긴다.<br/>

[네이버 지도 타입 깃허브](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/navermaps/index.d.ts)

[네이버 지도 가이드 깃허브](https://navermaps.github.io/maps.js.ncp/)

[네이버 지도 튜토리얼](https://navermaps.github.io/maps.js.ncp/docs/tutorial-2-Getting-Started.html)

[네이버 지도 API 문서](https://guide.ncloud-docs.com/docs/ko/maps-overview)

[Geolocation API 공식 문서](https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API/Using_the_Geolocation_API#%EC%98%88%EC%A0%9C)

[네이버지도 줌 레벨별 차이](https://snugis.tistory.com/123)
- 줌레벨과 관련해서는 네이버 지도는 1\~21단게를 사용중이며, 1\~6단계는 모두 같은 단계로 취급한다. 추상적으로는 16단계가 맞으나, 엄격히 말하면 21단계이다. <br/>

## 🧑‍💻 함께 찾은 방향성

해당 자료 조사를 바탕으로 동료들과 함께 회의를 진행했다.<br/>

어떤 관점에서 접근해야할 지, 어떤 기능이 필요한 지 등을 함께 논의하였다.<br/>

특히, 지도와 캔버스를 각기 다른 레이어로 두고 다루기로 했어서, 레이어 사이에 어떤 인터페이스를 바탕으로 다룰 것인지를 함께 논의하였다.<br/>

처음에는 다음과 같은 형태를 생각했었다.<br/>

```typescript
interface 주고받을데이터 {
  위도,
  경도,
  x,
  y
}
```

이를 바탕으로 생각하고 있었는데, 동료가 기가막힌 해결책을 주었다.<br/>

```typescript
interface 주고받을데이터 {
  위도,
  경도,
}
```

위도와 경도만을 갖고 데이터를 만들자.<br/>

그리고 이를 바탕으로 캔버스에서는 좌표로 바꿔서 출력을 하자는 의미였다.<br/>

배경이 되는 지도가 캔버스 위에 그려질 그림들의 기준이 되고 있고, 둘 사이를 연동하려면 어떤 기준점이 필요한데, 그걸 위도와 경도로 하면 어떻겠냐는 의견에서 였다.<br/>

처음에는 이해가 잘 되지 않았지만, 서로 그림을 그려가면서 구조를 논하였고, 이에 생각이 동기화되어 명확하게 이해할 수 있었다.<br/>

import map_and_canvas_interface_discussion1 from './img/map_and_cavnas_interface_discussion1.webp'

<figure>
  <img src={map_and_canvas_interface_discussion1} alt='회의 내용'/>
  <figcaption> 회의 내용 1 </figcaption>
</figure>

import map_and_canvas_interface_discussion2 from './img/map_and_cavnas_interface_discussion2.webp'

<figure>
  <img src={map_and_canvas_interface_discussion2} alt='회의 내용'/>
  <figcaption> 회의 내용 2 </figcaption>
</figure>

이렇게 시각적으로 함께 맞추어가다보니, 단순 인터페이스를 넘어서 어떻게 구현을 해야겠다가 보이기 시작했다.<br/>

그렇게 뽑아낸 내용은 다음과 같다. <br/>

- 지도와 캔버스는 각기 다른 레이어로 두고, 레이어 사이에는 위도와 경도를 주고 받는 인터페이스를 만들자.
- 캔버스에서는 지도의 위도와 경도를 받아서, 캔버스의 좌표로 바꾸어서 출력하자.
- 데이터는 (위도, 경도) 만을 다루자.
- 드래그 이벤트 시에는 각자 동일한 변화값 만큼 움직이면 될 것이다.
- 확대 축소시에는 동일한 비율로 확대 축소가 되면 될 것이다.

이렇게 함께 논의하고, 방향성을 잡았다.<br/>

## 🖼️ 작업 프로세스 추출

방향성이 잡히고, 본격적으로 작업에 착수하게 되었다.<br/>

그리고, 제일 먼저 한 일은, 내가 이걸 구현하기 위해서 어떤 과정을 거쳐야하는 지를 파악하는 것이었다.<br/>

import canvas_with_map_process_design from './img/canvas_with_map_process_design.webp'

<figure>
  <img src={canvas_with_map_process_design} alt='스토리북 이미지'/>
  <figcaption> 깃허브 이슈에 등록한 내 작업 목록 </figcaption>
</figure>

아직 어떤 기능이 필요한지, 특정한 문제를 해결하기 위해서는 얼마만큼의 시간이 필요한지 견적이 잡히지 않는 상황이었다.<br/>

그래서, 기존 개발 경험을 바탕으로 빠르게 예상되는 작업을 나열하고, 순서를 정리하였다. 그리고 그 과정 속에서 필요하다고 생각되는 것들을 적어두었다.<br/>

<details>
<summary>🚀 내가 등록해둔 이슈 살펴보기</summary>

#### 📌 요청 기능 설명

캔버스와 지도를 연동시켜서 같이 동작시킨다.

#### 📝 기능 세부 사항

1. 지도와 캔버스 연동 과정 설계
2. 지도 위에 캔버스 레이어 출력
  - 캔버스 컴포넌트 구현
  - 지도 위에 함께 배치하는 레이아웃 구현 (하나의 Container 위에 여러 레이아웃 겹쳐서 구현)
4. 지도의 끝 점과 캔버스 끝 점을 연계해서, 캔버스 좌표와 매핑
  - 지도의 꼭짓점 좌표를 알아내는 함수가 필요
  - 캔버스의 끝점의 크기를 알아내는 함수가 필요 (캔버스는 CSS와, 캔버스 내부 좌표가 일치해야함.)
  - 위도/경도 좌표 -> X, Y로 바꾸는 함수 구현
5. 드래그 이벤트 핸들러 구현
  - 드래그 시 캔버스가 이동되게 구현
  - 드래그 시 지도가 이동되게 구현
  - 드래그 시 캔버스의 좌표와 지도가 정확히 매핑되게 구현
6. 줌인 줌아웃 이벤트 핸들러 구현
  - 줌인/줌아웃 시 캔버스가 확대/축소 되게 구현
  - 줌인/줌아웃 시 지도가 확대/축소 되게 구현
  - 줌인/줌아웃 시 좌표와 지도가 정확히 매핑되게 구현


#### 🤔 기능 추가 배경 및 목적

MVP기능으로, 캔버스 위에 그리는 그림이 지도에 그대로 매핑될 수 있도록 기능을 제공해야 한다.

#### 🚩 완료 조건 (Acceptance Criteria)

- [ ] 설계에 대한 기술적인 근거가 명확해야 한다.
- [ ] 지도 위에 캔버스 레이어가 겹쳐서 보여진다.
- [ ] 화면을 드래그 하였을 때 지도와 캔버스가 같이 움직인다.
- [ ] 캔버스 위의 마커나 선이 지도의 위도, 경도 상에 정확하게 배치된다.
- [ ] 화면을 줌인/줌아웃 하였을 때 지도와 캔버스가 같이 확대 축소가 된다.
- [ ] 캔버스 위의 마커와 선의 확대 축소 비율이 지도와 동일하게 유지된다.
- [ ] 각 과정에 대한 테스트코드가 작성되어 있다.

#### 💡 참고 자료 (선택)

[React에서 Canvas 이미지 줌, 이동 기능 만들기](https://msm1307.tistory.com/87)
[노마드 코더 캔버스 강의 영상](https://nomadcoders.co/javascript-for-beginners-2/lectures/3740)

</details>

## 📝 설계에 대한 계획 수립

import canvas_with_map_process_design2 from './img/canvas_with_map_process_design2.webp'

<figure>
  <img src={canvas_with_map_process_design2} alt='스토리북 이미지'/>
  <figcaption> 깃허브 이슈에 등록한 내 설계 목록 </figcaption>
</figure>

나에게는 한가지 원칙이 있었다. <strong>"길을 먼저 보고 개발에 착수하자."</strong>는 것이다.<br/>

지금 상태로는 완벽한 설계는 불가능하다. 그렇다고 해서 아무것도 고려하지 않고 개발에 착수하면 그게 오히려 비용이 더 크게 든다고 생각했다.<br/>

그래서 최소한으로 필요하다고 생각되는 것만, 개발을 위한 길을 보는 느낌으로 설계해두기로 했다.<br/>

완벽하기 보다는 진짜 순수하게 길을 보는 용도로써의 설계. 그렇기에 설계는 최대한 간단하게, 그리고 빠르게 진행할 필요가 있었다.<br/>

이 역시도 대략적인 그림을 그리지 않고 설계에 들어갈 경우 시간이 많이 걸릴 위험이 있었다. <br/>

그래서 빠르게 무엇에 대해서 고려를 할 지 나열하고, 이에 대해서 순서를 정하였다. <br/>

<details>
<summary>🚀 내가 등록해둔 이슈 살펴보기</summary>

#### 📌 작업 제목

지도와 캔버스 연동 과정 설계

#### 🎯 목표

지도와 캔버스 연동 과정을 설계하고, 문서로 상세하게 작성한다.

#### 📝 작업 세부 사항

1. 지도와 캔버스 간의 좌표 변환 과정 설계
- 어떻게 (위도, 경도) &lt;-&rt; (x, y)로 변환할 건지 함수 설계
2. 컴포넌트 구조 설계
- z-index 기반으로 해서 어떻게 겹쳐서 보여줄 지 설계
- 레이어에 대해서 그림으로 그려서 표현하기
- 컴포넌트 계층도에 대해서 도식도로 그려서 표현하기
3. 로딩부터 동작까지 흐름 설계
- 초기 로딩 시에, 어떤 조건이 필요한지, 순서는 어떻게 되어야 하는 지 설계
- 예) 네이버 지도 로딩과, 서버에서 초기값 로딩이 필요하다. 네이버의 중심점 좌표를 잡기 위해서는 서버에서 받아와야 하기에 서버와의 통신이 먼저 이루어지고, 네이버 지도 로딩이 이루어져야 한다. 즉, 로딩은 먼저 하되 화면 출력은 이후에 한다. 와 같이 구체적으로 시나리오가 나와야 함.
- 이전 화면에서 데이터를 받는 지 여부, 받는다면 서버와의 통신에서도 어떻게 공통으로 뽑아낼 수 있을지에 대한 설계
4. 이벤트 발생 시 지도와 캔버스 위치를 어떻게 동기화시킬 지에 대해 설계
5. 각 과정에 따라 대충 그림이 그려지면, 프로토타입 구현을 통해 실현 가능 여부 판단

#### 🚩 완료 조건 (Acceptance Criteria)

- [ ] 지도와 캔버스 간의 좌표 변환 과정이 식으로 뚜렷하게 표현이 된다.
- [ ] 컴포넌트 구조가 도식도로 한 눈에 보이게 설계가 되었다. 그리고, 도식도만 보고도 어떻게 구현이 될 지 이해가 된다.
- [ ] 로딩부터 동작까지의 일련의 과정이 한 눈에 들어온다.
- [ ] 이벤트 발생 시 위치의 동기화를 어떻게 이룰 것인지 이해할 수 있다.
- [ ] 프로토타입을 통해서 각 과정이 실현 가능함을 보장할 수 있다.

#### 📅 예상 소요 시간 및 일정

2일 소요 예정입니다. (2MD -> 16시간 예정)
</details>

## 📝 본격적인 설계의 시작

제일 먼저 한 일은 프로젝트 자체에서의 지도와 캔버스의 구조를 파악하는 것이었다.<br/>

이를 파악하기 위해서, 동료들과 많은 이야기를 나누었다. 내가 생각하는 게 맞는지, 동료가 생각하는 바는 무엇인지 등 서로가 가진 생각을 동기화하는 시간을 가졌다.<br/>

그렇게 프로젝트에 대해서 서로가 생각하는 것을 일치 시키고, 이 내용을 바탕으로 다음과 같은 그림을 그렸다.<br/>

import canvas_and_map_structure from './img/canvas_and_map_structure.webp'

<figure>
  <img src={canvas_and_map_structure} alt='스토리북 이미지'/>
  <figcaption> 캔버스와 지도가 매핑되는 그림 </figcaption>
</figure>

이렇게 작성하면서 관련된 요소의 파악도 진행하였다.<br/>

- 캔버스는 왼쪽 위가 (0, 0) 이며, 오른쪽으로 가면 x가 증가하고, 아래로 가면 y가 증가한다.
- 경도(Longitude)는 캔버스상의 X좌표에 대응된다.
- 위도(Latitude)는 캔버스상의 Y좌표에 대응된다.
-

## 📈 캔버스와 지도의 좌표 변환 과정 설계

지도와 캔버스를 연동하기 위해서는 둘 다 어떻게 돌아가는 지 알아야할 필요가 있었다.<br/>

네이버 지도를 사용하기로 했기에 제일 먼저 한 일은 네이버 지도 API와 관련된 정보를 찾아보는 것이었다.<br/>



